<!DOCTYPE html>
<html>
  <head>
    <title>年会抽奖系统</title>
    <meta charset="utf-8">
    <link href="css/style.css?v=0.4" rel="stylesheet">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-166756784-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-166756784-1');
    </script>

  </head>
  <body>
  <!--第一屏-->

  <div class="lottery-fullscreen">
    <!--[if lt IE 10]>
    <p class="browsehappy">您的浏览器太老了，请到<a href="http://browsehappy.com/">下载一个新版浏览器</a>。</p>
    <![endif]-->
    <!--抽奖开始和抽奖结束备用按钮-->
    <nav class="aside-menu">
      <li>
        <div class="handle" id="reset">
          重置
        </div>
      <li>
        <div class="handle" id="handle" data-text-start="开始" data-text-stop="停止" data-action="start">
        </div>
      </li>
    </nav>

    <button id="go" data-text-start="按空格开始" data-text-stop="按空格停止" data-action="start"></button>
    <!-- 在抽奖按钮上方添加选择中奖人数的输入框和按钮 -->
    <div id="settings">
      <label for="num-lucky">抽奖人数：</label>
      <input type="number" id="num-lucky" value="1" min="1" max="30" />
    </div>
<!--    <div class="main-container" id="main-container">-->
<!--      <input id="showName" readonly type="text">-->
<!--    </div>-->
    <section>
      <div id="luckyDrawing"><input id="showName" readonly type="text"></div>
    </section>

    <!--抽奖按钮
    <div class="lottery-btn">抽奖</div>-->
    <div id="tips"></div>
  </div>
    <script src="js/sea.js"></script>
    <script>
      document.getElementById("num-lucky").addEventListener("change", function() {
        const numLucky = parseInt(this.value, 10);
        const container = document.getElementById("luckyDrawing");
        container.innerHTML = ''; // Clear existing text boxes

        for (let i = 0; i < numLucky; i++) {
          const textBox = document.createElement("input");
          textBox.type = "text";
          textBox.className = "text-box";
          textBox.id = "showName" + (i + 1); // Assign unique IDs
          textBox.placeholder = "Bosch"; // Set placeholder
          container.appendChild(textBox);
        }
      });
      // 禁用键盘输入，只允许拨动数字
      document.getElementById("num-lucky").addEventListener("keydown", function(e) {
        if (
                !['ArrowUp', 'ArrowDown', 'Tab', 'Backspace', 'Delete'].includes(e.key) &&
                !(e.ctrlKey && (e.key === 'c' || e.key === 'v')) // 允许复制和粘贴
        ) {
          e.preventDefault();
        }
      });

      // 禁用粘贴功能（可选）
      document.getElementById("num-lucky").addEventListener("paste", function(e) {
        e.preventDefault();
      });

      function removeStore(name) {
        if (!name) return
        try {
          window.localStorage.removeItem(name);
        }catch (e) {
          alert("操作失败！请重新操作~")
        }

      }
      function getStore(name) {
        if (!name) return;
        var value;
        try {
          value = JSON.parse(window.localStorage.getItem(name))
        } catch (e) {
          value = window.localStorage.getItem(name)
        }
        return value
      }
      var query = location.search.slice(1) || 'all';
      seajs.use(['./js/lucky', './js/data/data-' + query], function(Lucky, data) {
        var hasLuckyData = getStore('HASLUCKYDATA');
        if(hasLuckyData) {
          for (var j=0;j<hasLuckyData.length;j++) {
            $("#lucky-balls").append('<li class="selected"><p class="NT">' +hasLuckyData[j].NT + '</p><p class="name">' + hasLuckyData[j].name +'</p></li>')
            for (var i=0;i<data.length; i++) {
              if(data[i].id == hasLuckyData[j].id) {
                data.splice(i, 1);
                break;
              }
            }
          }
        }
        if(data&&data.length==0){
          console.log("先导入参与抽奖的用户名单")
          $("#tips").text("先导入参与抽奖的用户名单")
          return
        }
        Lucky.init(data)
      })
    </script>
  </body>
</html>
